openapi: 3.0.3
info:
  title: BUD API
  version: 1.0.0
  description: |
    å­ã©ã‚‚ãƒãƒ£ãƒ¬ãƒ³ã‚¸å¿œæ´ã‚¢ãƒ—ãƒªã€BUDã€ã®APIä»•æ§˜æ›¸

    ## æ¦‚è¦
    BUDã¯ã€å°å­¦ç”ŸãŒå¤–å›½äººã¨ã®å¯¾é¢äº¤æµã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã™ã‚‹ã“ã¨ã‚’æ”¯æ´ã™ã‚‹ã‚¢ãƒ—ãƒªã§ã™ã€‚
    è¦ªå­ã§æˆåŠŸä½“é¨“ã‚’è¨˜éŒ²ã—ã€æŒ¯ã‚Šè¿”ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

servers:
  - url: http://localhost:8000/api
    description: ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ
  - url: https://api.bud-app.com/v1
    description: æœ¬ç•ªç’°å¢ƒï¼ˆäºˆå®šï¼‰

tags:
  - name: health
    description: ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
  - name: auth
    description: èªè¨¼é–¢é€£ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  - name: children
    description: å­ã©ã‚‚ç®¡ç†é–¢é€£ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  - name: challenges
    description: ãƒãƒ£ãƒ¬ãƒ³ã‚¸è¨˜éŒ²é–¢é€£ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  - name: transcription
    description: éŸ³å£°æ–‡å­—èµ·ã“ã—é–¢é€£ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Googleãƒ­ã‚°ã‚¤ãƒ³å¾Œã«å–å¾—ã—ãŸã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨

paths:
  /health:
    get:
      summary: APIã®ç¨¼åƒçŠ¶æ…‹ã‚’ç¢ºèª
      description: APIã‚µãƒ¼ãƒãƒ¼ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
      tags:
        - health
      responses:
        "200":
          description: APIã¯æ­£å¸¸ã«ç¨¼åƒä¸­
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2024-08-01T12:00:00Z"

  /auth/google:
    post:
      summary: Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
      description: Googleã®èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã€ã‚¢ãƒ—ãƒªç”¨ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - idToken
              properties:
                idToken:
                  type: string
                  description: Googleã®IDãƒˆãƒ¼ã‚¯ãƒ³
                  example: "eyJhbGciOiJSUzI1NiIsImtpZCI..."
      responses:
        "200":
          description: ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                    description: BUDã‚¢ãƒ—ãƒªç”¨ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "user123"
                      email:
                        type: string
                        example: "parent@example.com"
                      name:
                        type: string
                        example: "ãƒ†ã‚¹ãƒˆå¤ªéƒ"
        "401":
          description: èªè¨¼å¤±æ•—
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid token"

  /children:
    get:
      summary: å­ã©ã‚‚ä¸€è¦§ã‚’å–å¾—
      description: ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹è¦ªã«ç´ã¥ãå­ã©ã‚‚ã®ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™
      tags:
        - children
      security:
        - BearerAuth: []
      responses:
        "200":
          description: å­ã©ã‚‚ä¸€è¦§ã®å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  children:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: "child_001"
                        name:
                          type: string
                          example: "ãŸã‚ã†"
                        birthdate:
                          type: string
                          example: "2024-08-01T10:00:00Z"
                          description: ç”Ÿå¹´æœˆæ—¥
                        createdAt:
                          type: string
                          format: date-time
                          example: "2024-08-01T10:00:00Z"

    post:
      summary: æ–°ã—ã„å­ã©ã‚‚ã‚’ç™»éŒ²
      description: æ–°ã—ã„å­ã©ã‚‚ã®æƒ…å ±ã‚’ç™»éŒ²ã—ã¾ã™
      tags:
        - children
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - grade
              properties:
                name:
                  type: string
                  example: "ã¯ãªã“"
                  description: å­ã©ã‚‚ã®åå‰
                birthdate:
                  type: string
                  example: "2024-08-01T10:00:00Z"
                  description: ç”Ÿå¹´æœˆæ—¥
      responses:
        "201":
          description: å­ã©ã‚‚ã®ç™»éŒ²æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    example: "child_002"
                  name:
                    type: string
                    example: "ã¯ãªã“"
                  birthdate:
                    type: string
                    example: "2024-08-01T10:00:00Z"
                  createdAt:
                    type: string
                    format: date-time
        "400":
          description: å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãŒä¸æ­£

  /children/{childId}:
    put:
      summary: å­ã©ã‚‚æƒ…å ±ã‚’æ›´æ–°
      description: æŒ‡å®šã—ãŸå­ã©ã‚‚ã®æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã™
      tags:
        - children
      security:
        - BearerAuth: []
      parameters:
        - name: childId
          in: path
          required: true
          description: å­ã©ã‚‚ã®ID
          schema:
            type: string
            example: "child_001"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: "ãŸã‚ã†"
                birthdate:
                  type: string
                  example: "2024-08-01T10:00:00Z"
      responses:
        "200":
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  name:
                    type: string
                  birthdate:
                    type: string
                  updatedAt:
                    type: string
                    format: date-time
        "404":
          description: å­ã©ã‚‚ãŒè¦‹ã¤ã‹ã‚‰ãªã„

  /challenges:
    post:
      summary: ãƒãƒ£ãƒ¬ãƒ³ã‚¸è¨˜éŒ²ã‚’ä½œæˆ
      description: |
        å­ã©ã‚‚ãŒå¤–å›½äººã¨è©±ã—ãŸè¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã™ã€‚

        - Phase 1: Web Speech APIã§å–å¾—æ¸ˆã¿ã®æ–‡å­—èµ·ã“ã—ãƒ†ã‚­ã‚¹ãƒˆã‚’é€ä¿¡
        - Phase 2: éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«IDã¨æ–‡å­—èµ·ã“ã—ãƒ†ã‚­ã‚¹ãƒˆã®ä¸¡æ–¹ã‚’é€ä¿¡å¯èƒ½
      tags:
        - challenges
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - childId
                - transcription
              properties:
                childId:
                  type: string
                  example: "child_001"
                  description: ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ãŸå­ã©ã‚‚ã®ID
                transcription:
                  type: string
                  example: "Hello! Where are you from?"
                  description: è©±ã—ãŸå†…å®¹ã®æ–‡å­—èµ·ã“ã—
                country:
                  type: string
                  example: "USA"
                  description: ç›¸æ‰‹ã®å‡ºèº«å›½ï¼ˆä»»æ„ï¼‰
                comment:
                  type: string
                  example: "åˆã‚ã¦è‡ªåˆ†ã‹ã‚‰è©±ã—ã‹ã‘ã‚‰ã‚ŒãŸï¼"
                  description: è¦ªã‚„å­ã©ã‚‚ã®ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆä»»æ„ï¼‰
                challengeType:
                  type: string
                  enum: ["wave", "greeting", "question", "conversation"]
                  example: "greeting"
                  description: |
                    ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã®ãƒ¬ãƒ™ãƒ«
                    - wave: æ‰‹ã‚’æŒ¯ã‚‹
                    - greeting: æŒ¨æ‹¶ã™ã‚‹ï¼ˆHelloç­‰ï¼‰
                    - question: è³ªå•ã™ã‚‹ï¼ˆWhere are you from?ç­‰ï¼‰
                    - conversation: ä¼šè©±ã™ã‚‹
      responses:
        "201":
          description: ãƒãƒ£ãƒ¬ãƒ³ã‚¸è¨˜éŒ²ã®ä½œæˆæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    example: "challenge_001"
                  childId:
                    type: string
                    example: "child_001"
                  transcription:
                    type: string
                  country:
                    type: string
                  comment:
                    type: string
                  challengeType:
                    type: string
                  createdAt:
                    type: string
                    format: date-time
        "400":
          description: å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãŒä¸æ­£

    get:
      summary: ãƒãƒ£ãƒ¬ãƒ³ã‚¸ä¸€è¦§ã‚’å–å¾—
      description: æ¡ä»¶ã«å¿œã˜ã¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸è¨˜éŒ²ã®ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™
      tags:
        - challenges
      security:
        - BearerAuth: []
      parameters:
        - name: childId
          in: query
          required: false
          description: ç‰¹å®šã®å­ã©ã‚‚ã®è¨˜éŒ²ã®ã¿å–å¾—
          schema:
            type: string
            example: "child_001"
        - name: limit
          in: query
          required: false
          description: å–å¾—ä»¶æ•°ã®ä¸Šé™
          schema:
            type: integer
            default: 20
            example: 10
        - name: offset
          in: query
          required: false
          description: å–å¾—é–‹å§‹ä½ç½®
          schema:
            type: integer
            default: 0
            example: 0
      responses:
        "200":
          description: ãƒãƒ£ãƒ¬ãƒ³ã‚¸ä¸€è¦§ã®å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  challenges:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: "challenge_001"
                        childId:
                          type: string
                          example: "child_001"
                        childName:
                          type: string
                          example: "ãŸã‚ã†"
                          description: å­ã©ã‚‚ã®åå‰ï¼ˆè¡¨ç¤ºç”¨ï¼‰
                        transcription:
                          type: string
                          example: "Hello! Nice to meet you!"
                        country:
                          type: string
                          example: "Canada"
                        challengeType:
                          type: string
                          example: "greeting"
                        createdAt:
                          type: string
                          format: date-time
                  total:
                    type: integer
                    example: 25
                    description: å…¨ä½“ã®è¨˜éŒ²æ•°
                  hasMore:
                    type: boolean
                    example: true
                    description: ã•ã‚‰ã«è¨˜éŒ²ãŒã‚ã‚‹ã‹ã©ã†ã‹

  /challenges/{challengeId}:
    get:
      summary: ãƒãƒ£ãƒ¬ãƒ³ã‚¸è©³ç´°ã‚’å–å¾—
      description: æŒ‡å®šã—ãŸãƒãƒ£ãƒ¬ãƒ³ã‚¸è¨˜éŒ²ã®è©³ç´°æƒ…å ±ã‚’å–å¾—ã—ã¾ã™
      tags:
        - challenges
      security:
        - BearerAuth: []
      parameters:
        - name: challengeId
          in: path
          required: true
          description: ãƒãƒ£ãƒ¬ãƒ³ã‚¸è¨˜éŒ²ã®ID
          schema:
            type: string
            example: "challenge_001"
      responses:
        "200":
          description: ãƒãƒ£ãƒ¬ãƒ³ã‚¸è©³ç´°ã®å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    example: "challenge_001"
                  childId:
                    type: string
                    example: "child_001"
                  childName:
                    type: string
                    example: "ãŸã‚ã†"
                  transcription:
                    type: string
                    example: "Hello! Where are you from? I'm from Japan!"
                  country:
                    type: string
                    example: "France"
                  comment:
                    type: string
                    example: "ãƒ•ãƒ©ãƒ³ã‚¹ã®äººã¨è©±ã›ãŸï¼æœ€åˆã¯ç·Šå¼µã—ãŸã‘ã©ã€å„ªã—ãç­”ãˆã¦ãã‚Œã¦å¬‰ã—ã‹ã£ãŸã€‚"
                  challengeType:
                    type: string
                    example: "question"
                  duration:
                    type: integer
                    example: 45
                    description: éŒ²éŸ³æ™‚é–“ï¼ˆç§’ï¼‰
                  aiReview:
                    type: object
                    description: AIã«ã‚ˆã‚‹ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆMVPæ®µéšã§ã¯å›ºå®šã€å°†æ¥OpenAIé€£æºäºˆå®šï¼‰
                    properties:
                      content:
                        type: string
                        example: |
                          ç´ æ™´ã‚‰ã—ã„ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã§ã—ãŸï¼ğŸ‰

                          ã€è‰¯ã‹ã£ãŸç‚¹ã€‘
                          - ã€ŒHelloã€ã®æŒ¨æ‹¶ãŒã¯ã£ãã‚Šã¨è¨€ãˆã¦ã„ã¾ã—ãŸ
                          - ã€ŒWhere are you from?ã€ã¨ã„ã†è³ªå•ã‚‚ã§ãã¾ã—ãŸ
                          - ç›¸æ‰‹ã®ç›®ã‚’è¦‹ã¦è©±ã›ã¦ã„ãŸã‚ˆã†ã§ã™ã­

                          ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã€‘
                          - ç›¸æ‰‹ã®ç­”ãˆã«ã€ŒThat's nice!ã€ã¨åå¿œã—ã¦ã¿ã¾ã—ã‚‡ã†
                          - è‡ªåˆ†ã®å¥½ããªã‚‚ã®ã‚‚è‹±èªã§ä¼ãˆã¦ã¿ã¾ã—ã‚‡ã†
                      positivePoints:
                        type: array
                        items:
                          type: string
                        example:
                          - "ã¯ã£ãã‚Šã¨ã—ãŸå£°ã§è©±ã›ãŸ"
                          - "è³ªå•ãŒã§ããŸ"
                          - "ç¬‘é¡”ã§æ¥ã™ã‚‹ã“ã¨ãŒã§ããŸ"
                      nextChallenges:
                        type: array
                        items:
                          type: string
                        example:
                          - "ç›¸æ‰‹ã®ç­”ãˆã«åå¿œã—ã¦ã¿ã‚ˆã†"
                          - "è‡ªå·±ç´¹ä»‹ã‚’ã—ã¦ã¿ã‚ˆã†"
                          - "å¥½ããªé£Ÿã¹ç‰©ã‚’èã„ã¦ã¿ã‚ˆã†"
                      encouragement:
                        type: string
                        example: "ã“ã®èª¿å­ã§é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼è‹±èªã§è©±ã™ã“ã¨ãŒã©ã‚“ã©ã‚“æ¥½ã—ããªã£ã¦ãã¾ã™ã‚ˆï¼"
                  createdAt:
                    type: string
                    format: date-time
                  updatedAt:
                    type: string
                    format: date-time
        "404":
          description: ãƒãƒ£ãƒ¬ãƒ³ã‚¸è¨˜éŒ²ãŒè¦‹ã¤ã‹ã‚‰ãªã„

  /transcription:
    post:
      summary: éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’æ–‡å­—èµ·ã“ã—ï¼ˆPhase 2ã§å®Ÿè£…äºˆå®šï¼‰
      description: |
        éŒ²éŸ³ã—ãŸéŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚

        ## å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º
        - **Phase 1 (MVP)**: Web Speech APIã‚’ä½¿ç”¨ã—ãŸãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ–‡å­—èµ·ã“ã—
          - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å®Œçµã™ã‚‹ãŸã‚ã€ã“ã®APIã¯ä½¿ç”¨ã—ãªã„
          - éŒ²éŸ³ã¨åŒæ™‚ã«æ–‡å­—èµ·ã“ã—ã‚’å®Ÿè¡Œ
          
        - **Phase 2 (å°†æ¥)**: MediaRecorder + Whisper API
          - MediaRecorder APIã§éŒ²éŸ³ã—ãŸéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é€ä¿¡
          - ã‚µãƒ¼ãƒãƒ¼å´ã§OpenAI Whisper APIã‚’ä½¿ç”¨ã—ã¦é«˜ç²¾åº¦ãªæ–‡å­—èµ·ã“ã—
          - ã“ã®APIã‚’ä½¿ç”¨
      tags:
        - transcription
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - audio
              properties:
                audio:
                  type: string
                  format: binary
                  description: |
                    éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆwav, mp3, m4a, webmç­‰ï¼‰
                    MediaRecorder APIã§éŒ²éŸ³ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«
                language:
                  type: string
                  default: "en"
                  example: "en"
                  description: |
                    éŸ³å£°ã®è¨€èªã‚³ãƒ¼ãƒ‰
                    - en: è‹±èª
                    - ja: æ—¥æœ¬èª
      responses:
        "200":
          description: æ–‡å­—èµ·ã“ã—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  transcription:
                    type: string
                    example: "Hello! Where are you from?"
                    description: Whisper APIã§æ–‡å­—èµ·ã“ã—ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆ
                  confidence:
                    type: number
                    format: float
                    minimum: 0
                    maximum: 1
                    example: 0.95
                    description: æ–‡å­—èµ·ã“ã—ã®ä¿¡é ¼åº¦ï¼ˆ0-1ï¼‰
                  duration:
                    type: integer
                    example: 5
                    description: éŸ³å£°ã®é•·ã•ï¼ˆç§’ï¼‰
                  detectedLanguage:
                    type: string
                    example: "en"
                    description: WhisperãŒæ¤œå‡ºã—ãŸè¨€èª
                  segments:
                    type: array
                    description: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæƒ…å ±
                    items:
                      type: object
                      properties:
                        start:
                          type: number
                          example: 0.0
                        end:
                          type: number
                          example: 2.5
                        text:
                          type: string
                          example: "Hello!"
        "400":
          description: |
            ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼
            - éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¸æ­£
            - ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„å½¢å¼
            - ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã‚‹ï¼ˆ25MBä»¥ä¸Šï¼‰
        "413":
          description: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã‚‹
        "500":
          description: Whisper APIå‡¦ç†ã‚¨ãƒ©ãƒ¼
